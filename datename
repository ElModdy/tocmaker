#!/bin/bash

red=`tput setaf 1`
green=`tput setaf 2`
bold=`tput bold`
reset=`tput sgr0`

echo -e " ${bold}y${reset}\t\t - Confirm suggestion"
echo -e " ${bold}<Enter>${reset}\t - Ignore"
echo -e " ${bold}<Type>${reset}\t\t - Change the name to input"

path="/home/usr/repos/tocmaker/"

cp "${path}blank.pdf" "${path}preview.pdf"

(qpdfview "${path}preview.pdf" &> /dev/null &)

for f in ./*.pdf; do
	/bin/cp -rf "$f" "${path}preview.pdf"
	date_in=`pdfinfo "$f" | sed -n 's/^CreationDate:\(.*\)$/\1/p'`
	suggested_name=`date -d "$date_in" +"%Y-%m-%d.pdf"`
	curr_name=`basename "$f"`

	[[ "$suggested_name" == "$curr_name" ]] && continue

	echo -e "${bold}${red}curr:${reset}\t${curr_name}"
	echo -e "${bold}${green}sugg:${reset}\t${suggested_name}"
	read -p 'Name (empty to confirm): ' ans

	case $ans in

		"")
			continue
			;;

		"y")
		 	ans="$suggested_name"
		 	;;

		*)
		 	ans="${ans}.pdf"
		 	;;
	esac

	mv "$f" "$ans" &> /dev/null
done

wmctrl -lp | awk '/preview - qpdfview/{print $3}' |
xargs kill

rm "${path}preview.pdf"
